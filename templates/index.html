<!DOCTYPE html>
<html lang="en" class="scroll-smooth" id="htmlRoot">
<head>

<!-- SEO + Social Sharing -->
<meta name="description" content="Mallu Video Chat â€“ Connect with random strangers instantly for real-time video conversations." />
<meta property="og:title" content="Mallu random strangers Video Chat" />
<meta property="og:description" content="Connect with strangers anonymously using our fast, secure, and fun video chat platform." />
<meta property="og:image" content="https://malluchat.online/static/favicon-96x96.png" />
<meta property="og:url" content="https://malluchat.online/" />




  
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="/static/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="/static/favicon.svg" />
<link rel="shortcut icon" href="/static/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/static/apple-touch-icon.png" />
<link rel="apple-touch-icon" href="/static/icons/icon-192.png" />

  <title>Mallu Video Chat
  
  </title>

  <!-- PWA -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#ffffff" />
  <link rel="apple-touch-icon" href="/icons/icon-192.png">

  <!-- Tailwind CSS -->
  <script>
    tailwind.config = { darkMode: 'class' };
  </script>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    video { border-radius: 1rem; background: black; }
    #chatMessages { overflow-y: auto; }
    #loader { backdrop-filter: blur(4px); }
  </style>
</head>

<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen flex flex-col items-center justify-center px-4 py-8 transition-colors duration-300">

  <!-- âœ… Online User Count -->
  <div id="onlineCount" class="fixed top-4 right-4 bg-green-600 text-white text-sm font-semibold px-4 py-2 rounded-full shadow-lg z-50">
    ğŸ‘¥ Online: 0
  </div>

  <!-- Loader -->
  <div id="loader" class="fixed inset-0 bg-white dark:bg-gray-900 bg-opacity-80 flex flex-col items-center justify-center z-50 hidden">
    <div class="w-12 h-12 border-4 border-blue-500 border-dashed rounded-full animate-spin mb-4"></div>
    <p class="text-lg font-semibold">Finding a stranger...</p>
  </div>

  <!-- Main Container -->
  <div class="w-full max-w-2xl px-4 sm:px-6 bg-white dark:bg-gray-800 p-6 sm:p-8 rounded-3xl shadow-xl space-y-6">

    <!-- Header -->
    <div class="text-center space-y-1">
      <h1 class="text-3xl font-bold text-blue-600 dark:text-blue-400">Mallu Video Chat</h1>
      <p id="statusBar" class="text-sm text-gray-500 dark:text-gray-400">ğŸ”„ Status: Waiting...</p>

      <!-- Dark Mode Toggle Button -->
      <div class="flex justify-center mt-2">
        <button onclick="toggleDarkMode()" class="text-sm text-gray-600 dark:text-gray-300 hover:text-blue-500 dark:hover:text-yellow-300 transition">
          ğŸŒ™ Toggle Dark Mode
        </button>
      </div>
    </div>

    <!-- Videos -->
    <div id="videos" class="space-y-4">
      <video id="localVideo" autoplay muted playsinline class="w-full aspect-video bg-black shadow rounded-xl"></video>
      <video id="remoteVideo" autoplay playsinline class="w-full aspect-video bg-black shadow rounded-xl"></video>
    </div>

    <!-- Controls -->
    <div class="flex flex-wrap gap-2 justify-center">
      <button onclick="toggleMic()" id="micBtn" class="bg-blue-600 hover:bg-blue-500 text-white px-5 py-2 rounded-full text-sm font-medium">ğŸ¤ Mute</button>
      <button onclick="toggleCam()" id="camBtn" class="bg-blue-600 hover:bg-blue-500 text-white px-5 py-2 rounded-full text-sm font-medium">ğŸ“· Camera Off</button>
      <button onclick="disconnectCall()" class="bg-red-600 hover:bg-red-500 text-white px-5 py-2 rounded-full text-sm font-medium">ğŸ”´ Disconnect</button>
    </div>

    <!-- Chat Area -->
    <div class="space-y-2">
      <div id="chatMessages" class="bg-gray-200 dark:bg-gray-700 p-4 rounded-xl h-40 text-sm space-y-2 overflow-y-auto"></div>
      <div class="flex gap-2">
        <input type="text" id="chatInput" placeholder="Type a message..." class="flex-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 px-4 py-2 rounded-full focus:outline-none text-sm text-gray-900 dark:text-white" />
        <button onclick="sendMessage()" class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-full text-sm font-medium">Send</button>
      </div>
    </div>

    <!-- Gender Selection -->
    <div class="flex justify-center gap-4">
      <button id="maleBtn" class="bg-blue-100 hover:bg-blue-200 text-blue-700 px-6 py-2 rounded-full text-sm font-semibold">ğŸ‘¨ Male</button>
      <button id="femaleBtn" class="bg-pink-100 hover:bg-pink-200 text-pink-700 px-6 py-2 rounded-full text-sm font-semibold">ğŸ‘© Female</button>
    </div>

    <!-- QR Code Message -->
    <div id="qrMessage" class="hidden text-center mt-4 text-sm text-pink-600 dark:text-pink-400 space-y-2">
      <p>ğŸ‘© Female option requires a one-time verification fee.<br>Please scan the QR code below to continue.</p>
      <img src="/static/60.png" alt="Payment QR" class="w-40 mx-auto rounded-lg border border-gray-300 dark:border-gray-600 shadow" />
    </div>

    <!-- Connect Button -->
    <div class="text-center">
      <button onclick="findStranger()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-full text-base font-semibold shadow-md">
        ğŸ”„ Connect to Stranger
      </button>
    </div>
  </div>

  <!-- Footer -->
  <footer class="mt-10 text-center text-xs text-gray-400 dark:text-gray-500 border-t border-gray-300 dark:border-gray-700 pt-4 w-full max-w-2xl">
    <p class="mb-2">
      By using this service, you agree to our
      <a href="#" class="text-blue-500 dark:text-blue-400 underline hover:text-blue-600 dark:hover:text-blue-300">Terms & Conditions</a> and
      <a href="#" class="text-blue-500 dark:text-blue-400 underline hover:text-blue-600 dark:hover:text-blue-300">Privacy Policy</a>.
    </p>
    <p>&copy; 2025 Mallu Video Chat. All rights reserved.</p>
  </footer>

  <!-- Scripts -->
  <script src="https://cdn.socket.io/4.3.2/socket.io.min.js"></script>
  <script>
    // Dark Mode Logic
    function toggleDarkMode() {
      const html = document.getElementById('htmlRoot');
      const isDark = html.classList.toggle('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
    }

    window.addEventListener('DOMContentLoaded', () => {
      const html = document.getElementById('htmlRoot');
      const theme = localStorage.getItem('theme');
      if (theme === 'dark') {
        html.classList.add('dark');
      } else {
        html.classList.remove('dark');
      }
    });

    // Video Chat Logic
    const socket = io();
    let localStream, peerConnection;
    const config = { iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] };

    const localVideo = document.getElementById('localVideo');
    const remoteVideo = document.getElementById('remoteVideo');
    const chatMessages = document.getElementById('chatMessages');
    const chatInput = document.getElementById('chatInput');
    const loader = document.getElementById('loader');
    const statusBar = document.getElementById('statusBar');
    const micBtn = document.getElementById('micBtn');
    const camBtn = document.getElementById('camBtn');

    let isMicOn = true, isCamOn = true;

    function updateStatus(msg, color = "text-gray-500") {
      statusBar.textContent = `ğŸ”„ Status: ${msg}`;
      statusBar.className = `text-sm ${color}`;
    }

    async function getMedia() {
      localStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
      localVideo.srcObject = localStream;
    }

    async function findStranger() {
      chatMessages.innerHTML = '';
      loader.classList.remove("hidden");
      updateStatus("Searching...");
      await getMedia();
      socket.emit('find_stranger');
    }

    function sendMessage() {
      const msg = chatInput.value.trim();
      if (!msg) return;
      appendMessage("You", msg, true);
      socket.emit('chat_message', msg);
      chatInput.value = '';
    }

    function appendMessage(sender, text, isUser = false) {
      const bubble = document.createElement("div");
      bubble.className = `max-w-[75%] px-4 py-2 rounded-2xl text-sm ${
        isUser
          ? "bg-blue-500 text-white self-end ml-auto"
          : "bg-gray-300 dark:bg-gray-600 text-gray-800 dark:text-gray-100 self-start mr-auto"
      }`;
      bubble.innerHTML = `<strong class="text-xs block">${sender}</strong>${text}`;
      const wrapper = document.createElement("div");
      wrapper.className = "flex flex-col";
      wrapper.appendChild(bubble);
      chatMessages.appendChild(wrapper);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function toggleMic() {
      isMicOn = !isMicOn;
      localStream.getAudioTracks().forEach(t => t.enabled = isMicOn);
      micBtn.textContent = isMicOn ? "ğŸ¤ Mute" : "ğŸ”‡ Unmute";
    }

    function toggleCam() {
      isCamOn = !isCamOn;
      localStream.getVideoTracks().forEach(t => t.enabled = isCamOn);
      camBtn.textContent = isCamOn ? "ğŸ“· Camera Off" : "ğŸ“µ Camera On";
    }

    function disconnectCall() {
      if (peerConnection) {
        peerConnection.close();
        peerConnection = null;
        remoteVideo.srcObject = null;
        updateStatus("Disconnected.", "text-red-500");
      }
    }

    socket.on('stranger_found', async (isCaller) => {
      loader.classList.add("hidden");
      updateStatus("Connected âœ…", "text-green-600");

      peerConnection = new RTCPeerConnection(config);
      localStream.getTracks().forEach(track => peerConnection.addTrack(track, localStream));
      peerConnection.ontrack = e => remoteVideo.srcObject = e.streams[0];
      peerConnection.onicecandidate = e => e.candidate && socket.emit('ice_candidate', e.candidate);

      if (isCaller) {
        const offer = await peerConnection.createOffer();
        await peerConnection.setLocalDescription(offer);
        socket.emit('offer', offer);
      }
    });

    socket.on('offer', async (offer) => {
      await peerConnection.setRemoteDescription(new RTCSessionDescription(offer));
      const answer = await peerConnection.createAnswer();
      await peerConnection.setLocalDescription(answer);
      socket.emit('answer', answer);
    });

    socket.on('answer', (answer) => {
      peerConnection.setRemoteDescription(new RTCSessionDescription(answer));
    });

    socket.on('ice_candidate', (candidate) => {
      peerConnection.addIceCandidate(new RTCIceCandidate(candidate));
    });

    socket.on('chat_message', (msg) => {
      appendMessage("Stranger", msg);
    });

    socket.on('stranger_disconnected', () => {
      remoteVideo.srcObject = null;
      updateStatus("Stranger disconnected", "text-red-500");
    });

    socket.on('show_alarm', () => {
      window.location.href = '/ashore';
    });

    socket.on('hide_alarm', () => {
      window.location.href = '/';
    });

    // ğŸ‘© QR Logic
    document.getElementById('femaleBtn').addEventListener('click', () => {
      document.getElementById('qrMessage').classList.remove('hidden');
    });

    document.getElementById('maleBtn').addEventListener('click', () => {
      document.getElementById('qrMessage').classList.add('hidden');
    });

    // âœ… Online Count Listener
    socket.on('online_count', (data) => {
      const countDisplay = document.getElementById('onlineCount');
      if (countDisplay) {
        countDisplay.textContent = `ğŸ‘¥ Online: ${data.count}`;
      }
    });

    // Service Worker Registration
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/service-worker.js')
        .then(() => console.log('Service Worker Registered âœ…'))
        .catch(err => console.error('SW registration failed âŒ', err));
    }
  </script>
</body>
</html>
